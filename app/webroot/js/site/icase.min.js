var mememaker={canvasId:"c1",activeObject:null,template:null,objects:[],canvas:null,lastImageX:10,lastImageY:10,lastTextX:150,lastTextY:10,textTotal:0,imageTotal:0,backgroundColor:"white",overlayImage:null,defaultText:null,init:null,mousedown:null,save:null,save_callback:null,reload:null,tools:{container:".tools",init:null,newcanvas:null,info:null,remove:null,group:null,backward:null,forward:null,toBack:null,toFront:null,flip:null,newtext:null,newpic:null,addpic:null,resize:null,preview:null,generate:null,preview2:null,generate2:null,backgroundcolor:null,newtemplate:null},texteditor:{id:null,current:null,init:null,fill:null,changeFontFamily:null,changeText:null,changeFontProperty:null,textselected:null},imageeditor:{id:null,current:null,zoomValue:null,rotateValue:null,init:null,zoom:null,rotate:null,flipX:null,flipY:null,imageselected:null},draweditor:{id:null,current:null,lineWidth:null,shadowWidth:null,init:null,fill:null,enable:null}};mememaker.defaultText={text:"Your Text Is Here",property:{fontFamily:"Impact",fontWeight:"bold",fontSize:40,fill:"black",originX:"left",originY:"top",left:mememaker.lastTextX,top:mememaker.lastTextY}};mememaker.mousedown=function(a){var b=a.target.type;switch(b){case"text":break;case"image":break;case"group":break;default:break}return false};mememaker.init=function(a){mememaker.canvasId=a;mememaker.canvas=new fabric.Canvas(mememaker.canvasId);mememaker.canvas.backgroundColor=mememaker.backgroundColor="#DDDDDD";mememaker.canvas.selection=true;mememaker.canvas.controlsAboveOverlay=true;mememaker.canvas.clear()};mememaker.save=function(){var a=JSON.stringify(mememaker.canvas.toJSON());mememaker.save_callback(a)};mememaker.reload=function(a){mememaker.canvas.loadFromJSON(a,function(){showAlert2("Loading content......");mememaker.canvas.renderAll();var b=mememaker.canvas.getObjects();$(b).each(function(c,d){if(d==null||d==undefined){return}if(d.type=="text"){d.on("selected",function(e){mememaker.texteditor.textselected()})}if(d.type=="image"){d.on("selected",function(e){mememaker.imageeditor.imageselected()})}});hideAlert()})};mememaker.tools.init=function(c,a,b){if(c!=null){mememaker.tools.container=c}jQuery("#canvas-background-color").colorpicker().on("changeColor",function(d){mememaker.tools.backgroundcolor(d.color.toHex());jQuery(this).css("background-color",d.color.toHex())});jQuery(mememaker.tools.container+" a").click(function(d){var e=jQuery(this).data("action");switch(e){case"new":mememaker.tools.newcanvas();break;case"info":break;case"remove":mememaker.tools.remove();break;case"group":mememaker.tools.group();break;case"backward":mememaker.tools.backward();break;case"forward":mememaker.tools.forward();break;case"back":mememaker.tools.toBack();break;case"front":mememaker.tools.toFront();break;case"flipx":mememaker.tools.flip(0);break;case"flipy":mememaker.tools.flip(1);break;case"newtext":mememaker.tools.newtext();break;case"newpic":break;case"+height":mememaker.tools.resize(true,this);break;case"-height":mememaker.tools.resize(false,this);break;case"preview":mememaker.tools.preview2();break;case"backgroundcolor":break;case"backgroundimage":break;case"draw":mememaker.draweditor.enable(jQuery(this));break;case"save":mememaker.save();break;case"reload":break;default:break}})};mememaker.tools.newcanvas=function(){mememaker.lastTextX=150;mememaker.lastTextY=10;mememaker.lastImageX=10;mememaker.lastImageY=10;mememaker.canvas.backgroundColor=mememaker.backgroundColor;mememaker.canvas.clear()};mememaker.tools.remove=function(){var a=mememaker.canvas.getActiveObject();if(a==null||a==undefined){a=mememaker.canvas.getActiveGroup();if(a==null||a==undefined){return}mememaker.canvas.discardActiveGroup();for(i=0;i<a.getObjects().length;++i){mememaker.canvas.remove(a.item(i))}return}mememaker.canvas.remove(a)};mememaker.tools.group=function(){var d=mememaker.canvas.getActiveGroup();if(d==null||d==undefined){return}var e=[];var b=[];var c=0;for(c=0;c<d.getObjects().length;++c){if(d.item(c).isType("image")){e[c]=null}else{e[c]=d.item(c).clone()}}for(c=0;c<d.getObjects().length;++c){if(d.item(c).isType("image")){b[c]=d.item(c)}else{b[c]=null}}function a(k,g,f,h){if(k>=f.length){var l=new fabric.Group(g,{left:h.left,top:h.top});mememaker.canvas.discardActiveGroup();for(c=0;c<g.length;++c){mememaker.canvas.remove(h.item(c))}mememaker.canvas.add(l);return}if(f[k]!=null){f[k].clone(function(j){g[k]=j;a(k+1,g,f,h)},null)}else{a(k+1,g,f,h)}}a(0,e,b,d)};mememaker.tools.backward=function(){var a=mememaker.canvas.getActiveObject();if(a==null||a==undefined){a=mememaker.canvas.getActiveGroup();if(a==null||a==undefined){return}a.sendBackwards();return}a.sendBackwards()};mememaker.tools.forward=function(){var a=mememaker.canvas.getActiveObject();if(a==null||a==undefined){a=mememaker.canvas.getActiveGroup();if(a==null||a==undefined){return}a.bringForward();return}a.bringForward()};mememaker.tools.toBack=function(){var a=mememaker.canvas.getActiveObject();if(a==null||a==undefined){a=mememaker.canvas.getActiveGroup();if(a==null||a==undefined){return}a.sendToBack();return}a.sendToBack()};mememaker.tools.toFront=function(){var a=mememaker.canvas.getActiveObject();if(a==null||a==undefined){a=mememaker.canvas.getActiveGroup();if(a==null||a==undefined){return}a.bringToFront();return}a.bringToFront()};mememaker.tools.flip=function(a){var b=mememaker.canvas.getActiveObject();if(b==null||b==undefined){b=mememaker.canvas.getActiveGroup();if(b==null||b==undefined){return}if(a==0){b.flipX=b.flipX==true?false:true}else{b.flipY=b.flipY==true?false:true}mememaker.canvas.renderAll();return}if(a==0){b.flipX=b.flipX==true?false:true}else{b.flipY=b.flipY==true?false:true}mememaker.canvas.renderAll()};mememaker.tools.newtext=function(){var a=new fabric.Text(mememaker.defaultText.text,mememaker.defaultText.property);a.text="CLICK TO EDIT";a.fontFamily=jQuery("#text-font-family").val();a.originX="center";a.originY="center";mememaker.canvas.add(a);a.center();a.scaleToWidth(300);mememaker.canvas.renderAll();a.on("selected",function(b){mememaker.texteditor.textselected()})};mememaker.tools.addpic=function(a){fabric.Image.fromURL(a,function(b){mememaker.canvas.add(b);b.center();b.scaleToWidth(400);mememaker.canvas.renderAll();b.on("selected",function(c){mememaker.imageeditor.imageselected()});hideAlert()})};mememaker.tools.resize=function(c,b){var a=jQuery("#"+jQuery(b).data("prefix")+"-height").val();a=jQuery.trim(a);if(a==""){a="0"}a=parseInt(a);if(c==false){if(a==0){return}if(mememaker.canvas.getHeight()-a<=0){mememaker.canvas.setDimensions({width:460,height:460})}else{mememaker.canvas.setDimensions({width:460,height:mememaker.canvas.getHeight()-a})}return}if(a==0){a=460}mememaker.canvas.setDimensions({width:460,height:mememaker.canvas.getHeight()+a})};mememaker.tools.zoomout=function(b){mememaker.canvas.setHeight(b);mememaker.canvas.setWidth(b);var h=b/780;var m=mememaker.canvas.getObjects();for(var e in m){var l=m[e].scaleX;var k=m[e].scaleY;var c=m[e].left;var j=m[e].top;var g=l*h;var f=k*h;var d=c*h;var a=j*h;m[e].scaleX=g;m[e].scaleY=f;m[e].left=d;m[e].top=a;m[e].setCoords()}mememaker.canvas.renderAll()};mememaker.tools.zoomreset=function(b){mememaker.canvas.setHeight(780);mememaker.canvas.setWidth(780);var h=780/b;var m=mememaker.canvas.getObjects();for(var e in m){var l=m[e].scaleX;var k=m[e].scaleY;var c=m[e].left;var j=m[e].top;var g=l*h;var f=k*h;var d=c*h;var a=j*h;m[e].scaleX=g;m[e].scaleY=f;m[e].left=d;m[e].top=a;m[e].setCoords()}mememaker.canvas.renderAll()};mememaker.tools.preview=function(a){mememaker.tools.zoomout(a);mememaker.canvas.deactivateAll();mememaker.canvas.overlayImage=null;mememaker.canvas.renderAll.bind(mememaker.canvas);var b=mememaker.canvas.toDataURL({format:"jpeg",quality:1});mememaker.tools.zoomreset(a);mememaker.tools.newtemplate(mememaker.overlayImage);if(mememaker.tools.generate==null){return}mememaker.tools.generate(b)};mememaker.tools.preview2=function(){mememaker.canvas.deactivateAll();mememaker.canvas.renderAll.bind(mememaker.canvas);var a=mememaker.canvas.toDataURL({format:"jpeg",quality:1});if(mememaker.tools.generate2==null){return}mememaker.tools.generate2(a)};mememaker.tools.generate=null;mememaker.tools.backgroundcolor=function(a){mememaker.canvas.backgroundColor=a;mememaker.canvas.renderAll()};mememaker.tools.backgroundimage=function(a){mememaker.canvas.setBackgroundImage(a,function(){mememaker.canvas.renderAll()},{originX:"left",originY:"top",left:0,top:0})};mememaker.tools.newtemplate=function(a){mememaker.overlayImage=a;mememaker.canvas.setOverlayImage(a,mememaker.canvas.renderAll.bind(mememaker.canvas))};mememaker.texteditor.init=function(a){if(a!==null){mememaker.texteditor.id=a}jQuery("#text-font-family").change(function(){mememaker.texteditor.changeFontFamily(jQuery(this).val())});jQuery("#text-fill").colorpicker().on("changeColor",function(b){mememaker.texteditor.fill(b.color.toHex())});jQuery("#text-text").keyup(function(b){if(b.which==13){b.preventDefault();mememaker.texteditor.changeText();return}mememaker.texteditor.changeText()});jQuery(mememaker.texteditor.id+" a").click(function(){switch(jQuery(this).data("action")){case"bold":mememaker.texteditor.changeFontProperty("weight");break;case"italic":mememaker.texteditor.changeFontProperty("italic");break}})};mememaker.texteditor.textselected=function(a){var b=mememaker.canvas.getActiveObject();if(b==null||b==undefined){return}if(b.type!="text"){return}jQuery("#text-text").val(b.text);jQuery("#text-font-family").val(b.fontFamily);jQuery("#text-fill").val(b.fill);jQuery(".editor").hide(0);jQuery(".text-editor").show(0)};mememaker.texteditor.fill=function(a){var b=mememaker.canvas.getActiveObject();if(b==null||b==undefined){return}if(b.type!="text"){return}b.fill=a;mememaker.canvas.renderAll()};mememaker.texteditor.changeFontFamily=function(a){var b=mememaker.canvas.getActiveObject();if(b==null||b==undefined){return}if(b.type!="text"){return}b.fontFamily=a;mememaker.canvas.renderAll()};mememaker.texteditor.changeText=function(a){var b=mememaker.canvas.getActiveObject();if(b==null||b==undefined){return}if(b.type!="text"){return}b.text=jQuery("#text-text").val();if(b.text==""){mememaker.canvas.remove(b)}mememaker.canvas.renderAll()};mememaker.texteditor.changeFontProperty=function(b){var a=mememaker.canvas.getActiveObject();if(a==null||a==undefined){return}if(a.type!="text"){return}if(b=="weight"){if(a.fontWeight=="normal"){a.fontWeight="bold"}else{if(a.fontWeight=="bold"){a.fontWeight="normal"}}}if(b=="italic"){if(a.fontStyle=="italic"){a.fontStyle=""}else{a.fontStyle="italic"}}mememaker.canvas.renderAll()};mememaker.imageeditor.init=function(a){if(a!==null){mememaker.imageeditor.id=a}mememaker.imageeditor.zoomValue=jQuery("#image-zoom").slider({formater:function(b){return""+b/100}}).on("slide",function(){mememaker.imageeditor.zoom(mememaker.imageeditor.zoomValue.getValue())}).data("slider");mememaker.imageeditor.rotateValue=jQuery("#image-rotation").slider({formater:function(b){return""+b}}).on("slide",function(){mememaker.imageeditor.rotate(mememaker.imageeditor.rotateValue.getValue())}).data("slider")};mememaker.imageeditor.imageselected=function(){var a=mememaker.canvas.getActiveObject();if(a==null||a==undefined){return}if(a.type!="image"){return}jQuery(".editor").hide(0);jQuery(".image-editor").show(0)};mememaker.imageeditor.zoom=function(b){var a=mememaker.canvas.getActiveObject();if(a==null||a==undefined){return}if(a.type!="image"){return}var c=b/100;a.scale(c);mememaker.canvas.renderAll()};mememaker.imageeditor.rotate=function(b){var a=mememaker.canvas.getActiveObject();if(a==null||a==undefined){return}if(a.type!="image"){return}a.originX="center";a.originY="center";a.angle=b;mememaker.canvas.renderAll()};mememaker.draweditor.init=function(a){if(a!==null){mememaker.draweditor.id=a}mememaker.draweditor.lineWidth=jQuery("#draw-width").slider({formater:function(b){return""+b}}).on("slide",function(){mememaker.canvas.freeDrawingBrush.width=mememaker.draweditor.lineWidth.getValue()}).data("slider");mememaker.draweditor.shadowWidth=jQuery("#draw-shadow-width").slider({formater:function(b){return""+b}}).on("slide",function(){mememaker.canvas.freeDrawingBrush.shadowBlur=mememaker.draweditor.shadowWidth.getValue()}).data("slider");jQuery("#draw-fill").colorpicker().on("changeColor",function(b){mememaker.canvas.freeDrawingBrush.color=b.color.toHex()});jQuery("#draw-mode-selector").on("change",function(){if(this.value==="hline"){if(fabric.PatternBrush){var d=new fabric.PatternBrush(mememaker.canvas);d.getPatternSrc=function(){var j=fabric.document.createElement("canvas");j.width=j.height=10;var h=j.getContext("2d");h.strokeStyle=this.color;h.lineWidth=5;h.beginPath();h.moveTo(0,5);h.lineTo(10,5);h.closePath();h.stroke();return j}}mememaker.canvas.freeDrawingBrush=d}else{if(this.value==="vline"){if(fabric.PatternBrush){var e=new fabric.PatternBrush(mememaker.canvas);e.getPatternSrc=function(){var j=fabric.document.createElement("canvas");j.width=j.height=10;var h=j.getContext("2d");h.strokeStyle=this.color;h.lineWidth=5;h.beginPath();h.moveTo(5,0);h.lineTo(5,10);h.closePath();h.stroke();return j}}mememaker.canvas.freeDrawingBrush=e}else{if(this.value==="square"){if(fabric.PatternBrush){var c=new fabric.PatternBrush(mememaker.canvas);c.getPatternSrc=function(){var l=10,j=2;var k=fabric.document.createElement("canvas");k.width=k.height=l+j;var h=k.getContext("2d");h.fillStyle=this.color;h.fillRect(0,0,l,l);return k}}mememaker.canvas.freeDrawingBrush=c}else{if(this.value==="diamond"){if(fabric.PatternBrush){var g=new fabric.PatternBrush(mememaker.canvas);g.getPatternSrc=function(){var n=10,l=5;var m=fabric.document.createElement("canvas");var k=new fabric.Rect({width:n,height:n,angle:45,fill:this.color});var h=k.getBoundingRectWidth();m.width=m.height=h+l;k.set({left:h/2,top:h/2});var j=m.getContext("2d");k.render(j);return m}}mememaker.canvas.freeDrawingBrush=g}else{if(this.value==="texture"){if(fabric.PatternBrush){var b=new Image();b.src="img/texture/texture_honey.png";var f=new fabric.PatternBrush(mememaker.canvas);f.source=b}mememaker.canvas.freeDrawingBrush=f}else{mememaker.canvas.freeDrawingBrush=new fabric[this.value+"Brush"](mememaker.canvas)}}}}}if(mememaker.canvas.freeDrawingBrush){mememaker.canvas.freeDrawingBrush.color=jQuery("#draw-fill").val();mememaker.canvas.freeDrawingBrush.width=mememaker.draweditor.lineWidth.getValue();mememaker.canvas.freeDrawingBrush.shadowBlur=mememaker.draweditor.shadowWidth.getValue()}})};mememaker.draweditor.enable=function(b){enable=mememaker.canvas.isDrawingMode==true?false:true;if(enable){jQuery(b).css("color","green");mememaker.canvas.discardActiveObject();mememaker.canvas.discardActiveGroup();var a=jQuery("#draw-width").val();if(a!=""){a=parseInt(a)}mememaker.canvas.isDrawingMode=true;mememaker.canvas.freeDrawingBrush.width=a;mememaker.canvas.freeDrawingBrush.color=jQuery("#draw-fill").val();jQuery(".editor").hide(0);jQuery(".draw-editor").show(0)}else{jQuery(b).css("color","#c24f19");mememaker.canvas.discardActiveObject();mememaker.canvas.discardActiveGroup();mememaker.canvas.isDrawingMode=false}};