(function(b){var a=function(){};a.prototype={zoomcount:0,resize:null,init:null,selected:false,toolsinit:null,texteditorinit:null,imageeditorinit:null,draweditorinit:null};a.prototype.init=function(e,d){function c(){b.mememaker.update()}b(window).resize(function(){clearTimeout(this.resize);this.resize=setTimeout(c,100)});b(document).mousemove(function(f){b.mememaker.mousex=f.pageX;b.mememaker.mousey=f.pageY;b.mememaker.imageeditor.cropresize(f)});b(document).mousedown(function(f){b.mememaker.mousex=f.pageX;b.mememaker.mousey=f.pageY;b.mememaker.update();b.mememaker.imageeditor.cropselect(f)});b(document).mouseup(function(g){b.mememaker.mousex=g.pageX;b.mememaker.mousey=g.pageY;b.mememaker.update();b.mememaker.imageeditor.cropunselect();var f=b.mememaker.canvas.getActiveObject();if(f===undefined||f===null){return}if(!b.mememaker.inEl(f)){return}if(f.lockMovementX==true){return}if(b.mememaker.grid.visible){var i=Math.ceil(f.left-f.getBoundingRectWidth()/2);var h=Math.ceil(f.top-f.getBoundingRectHeight()/2);if((i%20)/20>0.5){i+=20-(i%20)}else{i-=(i%20)}if((h%20)/20>0.5){h+=20-(h%20)}else{h-=(h%20)}f.left=i+f.getBoundingRectWidth()/2;f.top=h+f.getBoundingRectHeight()/2;b.mememaker.canvas.renderAll()}if(f.type=="text"){if(b.mememaker.activex!=f.left||b.mememaker.activey!=f.top){b.mememaker.texteditor.textselected();b.mememaker.activex=f.left;b.mememaker.activey=f.top}}});b.mememaker.init(e,d,1850/780)};a.prototype.reload=function(){jQuery.ajax({url:"process/index.php?action=reload",type:"GET",beforeSend:function(c){showAlert2("Reloading......")}}).done(function(d){var c=b.parseJSON(d);if(c.error==1){}else{b.mememaker.tools.reload(c.data.json)}hideAlert()}).fail(function(){showAlert2("failed")})};a.prototype.toolsinit=function(d){console.log("toolsinit");b.mememaker.tools.init();b("#bg-color-picker").spectrum({color:"yellow",show:function(){b(this).parent().parent().css("display","block")},change:function(e){var e=e.toHexString();b.mememaker.tools.backgroundcolor(e);b(this).parent().parent().attr("style","")}});b.mememaker.tools.addpic_callback=function(){hideAlert()};b.mememaker.tools.move_callback=function(){b(".text-editor").hide();b(".image-editor").hide()};b("#box-editing .span12").scroll(function(){console.log("scroll");b.mememaker.canvas.calcOffset();b.mememaker.update()});b.mememaker.tools.save_callback=function(e){jQuery.ajax({url:"process/index.php?action=save",data:{json:e},type:"POST",beforeSend:function(f){showAlert2("Saving......")}}).done(function(g){var f=b.parseJSON(g);if(f.error==1){b("#modal-user").modal();formuser_load()}else{b("#canvas_guid").val(f.data.guid);b("#canvas_guid").data("saved","1");alert("Your progress just saved")}hideAlert()}).fail(function(){showAlert2("Failed")})};b.mememaker.tools.preview_callback=function c(e){b("#modal-preview").modal();jQuery.ajax({url:"process/index.php?action=preview",data:{"image-extension":"jpeg","image-data":e},type:"POST",beforeSend:function(f){}}).done(function(h){var f=jQuery.parseJSON(h);if(f.error==0){var g=f.files.url;b("#modal-preview .modal-body").html("<img src='"+g+"' style='width:100%;height:100%' />")}(h)}).fail(function(){jQuery(".ajax-loading-indicator").hide(0)})};b(d+" a").click(function(e){var j=b(this).data("action");if(j===undefined||j===null){return}console.log(j);switch(j){case"new":b.mememaker.tools.newcanvas("#eb3d2d");break;case"remove":if(b.mememaker.tools.exist()==false){return}var i=confirm("You will remove this element, are u sure?");if(i==true){}else{return}var h=b.mememaker.tools.remove();if(h=="text"){b(".text-editor").hide()}break;case"group":b.mememaker.tools.group();break;case"moveleft":case"moveright":case"moveup":case"movedown":b.mememaker.sender="move";b.mememaker.tools.move(j);break;case"lock":var h=b.mememaker.tools.lock();if(h){b(".text-editor").hide()}break;case"backward":b.mememaker.tools.toBack();break;case"forward":b.mememaker.tools.toFront();break;case"back":b.mememaker.tools.toBack();break;case"front":b.mememaker.tools.toFront();break;case"flipx":b.mememaker.tools.flip(0);break;case"flipy":b.mememaker.tools.flip(1);break;case"addtext":b.mememaker.tools.addtext();break;case"preview":b.mememaker.tools.preview();break;case"background":b("#box-toolbar-bg").show();break;case"addshape":b("#box-toolbar-shape").show();break;case"shape-rect":case"shape-circle":case"shape-tri":b.mememaker.tools.addshape(b(this).data("data"));break;case"backgroundcolor":var f=b(this).data("data");b.mememaker.tools.backgroundcolor(f);break;case"backgroundimage":break;case"draw":if(b.mememaker.draweditor.enable()){b(this).data("color",b(this).css("color"));b(this).css("color","green")}else{b(this).css("color",b(this).data("color"))}break;case"addgrid":b.mememaker.tools.showgrid();break;case"undo":b.mememaker.tools.undo();break;case"save":b.mememakerinit.zoomcount=0;b("#box-canvas-wrapper").css("width",b.mememaker.width+"px");b.mememaker.tools.save();break;case"reload":b.mememakerinit.zoomcount=0;b("#box-canvas-wrapper").css("width",b.mememaker.width+"px");b.mememakerinit.reload();break;case"zoomin":if(b.mememakerinit.zoomcount>=4){alert("You reach the maxium zoom level");return}var g=b("#box-canvas-wrapper").width();g*=1.2;g=Math.ceil(g);b.mememakerinit.zoomcount++;b("#box-canvas-wrapper").css("width",g+"px");b.mememaker.tools.zoom(g);b(this).parent().next().removeClass("disabled");b(this).parent().next().next().removeClass("disabled");break;case"zoomout":if(b(this).parent().hasClass("disabled")){return}if(b.mememakerinit.zoomcount<0){return}var g=b("#box-canvas-wrapper").width();g*=1/1.2;g=Math.ceil(g);if(g<=b.mememaker.width){b("#box-canvas-wrapper").css("width",b.mememaker.width+"px");b.mememaker.tools.zoomreset();b.mememakerinit.zoomcount=0;b(this).parent().addClass("disabled");b(this).parent().next().addClass("disabled");return}b.mememakerinit.zoomcount--;b("#box-canvas-wrapper").css("width",g+"px");b.mememaker.tools.zoom(g);break;case"zoomfit":if(b(this).parent().hasClass("disabled")){return}b.mememakerinit.zoomcount=0;b("#box-canvas-wrapper").css("width",b.mememaker.width+"px");b.mememaker.tools.zoomreset();b(this).parent().addClass("disabled");b(this).parent().prev().addClass("disabled");break;default:break}})};a.prototype.texteditorinit=function(c){b.mememaker.texteditor.textselected=function(){var e=b.mememaker.canvas.getActiveObject();if(e===undefined||e===null){return}if(e.type!="text"){return}var d=e.getBoundingRectHeight();var g=e.top+d/2+10+b.mememaker.top;var f=e.left-e.getBoundingRectWidth()/2+b.mememaker.left;g=Math.floor(g);f=Math.ceil(f-(500-e.getBoundingRectWidth())/2);b(".text-editor").show();b(".text-editor").css("top",g+"px");b(".text-editor").css("left",f+"px");b("#text-content").val(e.text)};b("#font-color-picker").spectrum({color:"yellow",show:function(){b(this).parent().parent().css("display","block")},change:function(d){var d=d.toHexString();b.mememaker.texteditor.changeFontColor(d);b(this).parent().parent().attr("style","")}});b(c+" a").click(function(){var f=b(this).data("action");console.log(f);switch(f){case"weight":case"italic":case"underline":b.mememaker.texteditor.changeFontProperty(f);break;case"size":var e=b(this).data("data");e=parseInt(e);b.mememaker.texteditor.changeFontSize(e);break;case"color":var d=b(this).data("data");b.mememaker.texteditor.changeFontColor(d);break;case"align":var h=b(this).data("data");b.mememaker.texteditor.changeFontAlign(h);break;case"confirm":var g=b("#text-content").val();if(b.trim(g)==""){alert("Empty typo, if you insist, remove element instead");return}b.mememaker.texteditor.changeText(g);b.mememaker.texteditor.textselected();break;case"close":b("#box-toolbar-texteditor").hide();break;default:break}})};a.prototype.imageeditorinit=function(c){b.mememaker.imageeditor.init();b.mememaker.imageeditor.imageselected=function(){var e=b.mememaker.canvas.getActiveObject();if(e===undefined||e===null){return}if(e.type!="image"){return}var d=e.getBoundingRectHeight();var g=e.top+d/2+10+b.mememaker.top;var f=e.left-e.getBoundingRectWidth()/2+b.mememaker.left;g=Math.floor(g);f=Math.ceil(f-(100-e.getBoundingRectWidth())/2);b(".text-editor").hide();b(".image-editor").show();b(".image-editor").css("top",g+"px");b(".image-editor").css("left",f+"px")};b(c+" a").click(function(){var d=b(this).data("action");console.log(d);switch(d){case"cropstart":b.mememaker.imageeditor.cropstart();break;case"cropend":b.mememaker.imageeditor.cropend();break;case"close":b.mememaker.imageeditor.cropcancel();b(".image-editor").hide();break;default:break}});localStorage.state2=localStorage.state=JSON.stringify([]);console.log(localStorage.state)};a.prototype.draweditorinit=function(c){};b.mememakerinit=new a()}(window.jQuery));